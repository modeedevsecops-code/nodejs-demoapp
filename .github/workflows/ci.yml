name: Secret Scanning - Gitleaks

on:
  push:
    branches:
      - main
      - 'feature/*'
  pull_request:
    branches:
      - main

jobs:
  gitleaks:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Gitleaks
        uses: zricethezav/gitleaks-action@v1

      - name: Run Gitleaks Secret Scan
        id: gitleaks_scan
        uses: zricethezav/gitleaks-action@v1
        with:
          config-path: .gitleaks.toml  # Optional: path to your custom config
          leak-detection: true
          verbose: true

      - name: Fail if leaks found
        if: steps.gitleaks_scan.outputs.leaks_found == 'true'
        run: |
          echo "Secrets found in the repository! Please check the Gitleaks scan result."
          exit 1

      - name: No leaks found
        if: steps.gitleaks_scan.outputs.leaks_found != 'true'
        run: echo "No secrets found, scan passed!"
Breakdown of the workflow:
Trigger Events:

The workflow runs on push events to the main branch and any branch under feature/*.

It also runs on pull_request events targeting main.

Jobs:

The job runs on the ubuntu-latest runner.

The actions/checkout@v2 action checks out the repository code.

The zricethezav/gitleaks-action@v1 action performs the secret scan.

Custom Config (Optional):

If you have a custom .gitleaks.toml configuration file, you can specify it using the config-path input.

Leak Detection:

If gitleaks finds any secrets, it sets the output leaks_found to true.

If secrets are found, the workflow will fail (exit 1), prompting the user to check the scan result.

If no secrets are found, it prints a success message.

Optional Customization:
Custom Config: If you want to use a custom configuration for Gitleaks (like custom rules or regex for secret patterns), place your .gitleaks.toml configuration file in your repository and point to it using the config-path option.

Scan Specific Directories: You can add specific directories to scan if you donâ€™t want to scan the entire repository.

For more detailed information on configuring Gitleaks, check out the official Gitleaks documentation.

How to use:
Commit this YAML file to your repository.

When you push to the main branch or create a pull request, GitHub Actions will run the Gitleaks scan automatically.

Let me know if you need further customizations or explanations!


